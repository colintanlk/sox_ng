# Distro sox

## Notes for maintainers of sox.sf.net

`sox_ng` stems from `sox-14.4.2`, not from a more recent `sox.sf.net` commit,
because the first `sox_ng` release (micro) concentrates on bug fixes and
* patches in the distros, mostly based on 14.4.2, are more likely to apply cleanly
* sox.sf.net since 14.4.2 has 184 commits: a mixture of bug fixes, new features, build system fixes, code reformatting and refactoring and who knows what else
* the regression test suite shows that 42b355 fails on some CVEs that 14.4.2 doesn't, so it has more bugs as well as less. See [Testing](Testing).

Some of its commits have been applied: those which became Debian patches
and others necessary for other patches to apply including:
* [9ce4a4a](https://sourceforge.net/p/sox/code/ci/9ce4a4a):: `Segmentation fault in rate.c:504:30` See [bug 334](https://sourceforge.net/p/sox/bugs/334) and issue #56.
* [ccedd08](https://sourceforge.net/p/sox/code/ci/ccedd08): `Clean up lsx_malloc and friends` See issue #57.

and it would be worth scanning the 169 commits since 14.4.2 for bug fixes.

## Issues

[Bugs reported on `sox.sf.net`](https://sourceforge.net/p/sox/bugs) since 14.4.2 need importing into the `sox_ng` issue tracker.

## TODO

### Fix bug 321

[Bug 321](https://sourceforge.net/p/sox/bugs/321): Stack-Buffer-Overflow in fft4g.c
is addressed by [patch b7883ae](https://sourceforge.net/p/sox/code/ci/b7883ae),
imported by Debian, but on the test case it makes sox loop for 6 seconds
consuming gigabytes of memory and creates a 127MB audio file of random noise
just over an hour long. See issue #18: CVE-2017-8356.

This is because the check against `FFT4G_MAX_SIZE` makes the functions
in `fft4g.c` `return` instead of failing. The solution is to turn each
```
    if (n > FFT4G_MAX_SIZE)
        return;
```
into
```
    if (n > FFT4G_MAX_SIZE) {
        lsx_fail("FFT size is too large");
        exit(2);
    }
```

### Add `README` to the repository

SoX's `README` file is generated by `README.sh` and is not included
in the repository. As a consequence, code browsed at `sox.sf.net`
shows at the bottom of the page `README.osx` or `README.win32`
which are irrelevant.

It would be better to run `README.sh` and add the generated `README`
to the repository. People editing `README.sh` or `FEATURES.in`
will have to remember to update `README` too and commit it,
unless this can be automated.

### Import patches

If `sox.sf.net` maintainers wish to import patches from `sox_ng`
and make a `sox-14.4.3` release, that is of course fine.
After all, it's where everyone goes to get the latest `sox`
and where semiautomatic distros update from.
